# Recent publications

This page is automatically generated by harvesting information from
[ORCID.org](http://orcid.org).  Starting with a list of maths
researchers with ORCIDs we can curate a list of recent publications.


```{r setup, include = FALSE, cache = FALSE}
require(DT)
require(rorcid)
library(RefManageR)
require(xtable)
require(knitr)
BibOptions(check.entries = FALSE, style = "markdown", bib.style = "authoryear", cite.style = 'alphabetic', max.names=7)
opts_chunk$set(cache=TRUE)
```

This is a bit rough around the edges, but should provide for a useful
case-study.


### Who do we have in the data base?

We start by reading in the database:

```{r read_data}
maths_csv =  read.csv("maths_orcid.csv", comment.char='#')
##print(xtable(damtp.csv), type="html")
orcids1 = as.character(maths_csv$orcid)
orcids = orcids1[nchar(orcids1)>0]  # not everyone has an orcid
print(orcids)
```

We have `r length(orcid)` records in the data base.  (Note that the
number in the previous sentence is not hardcoded in the document, it
is the result of some inline R computation.)

## Interrogate rorcid

Starting with just the ORCIDs, we can get some information such as
names, and DOIs associated with each user.

```{r read_records}
get_orcid_info <- function(orcid_num) {
  info <- orcid_id(orcid = orcid_num)
  given <- info[[1]]$name$`given-names`$value
  family <- info[[1]]$name$`family-name`$value
  works <- works(orcid_num)
  my_dois <- rorcid::identifiers(works)
  num_dois <- length(my_dois)

  list(orcid = orcid_num,
       given = given,
       family = family,
       num_dois = num_dois,
       dois = my_dois)
  
}

results <- lapply(orcids, get_orcid_info)
```

Now we convert these results into a friendly form of a data frame.

```{r data-frame}
given <- sapply(results, function(x) x$given)
family <- sapply(results, function(x) x$family)
orcid <- sapply(results, function(x) x$orcid)
doi_n <- sapply(results, function(x) x$num_dois)

results_df <- data.frame(orcid=orcid, given=given, family=family, doi_n=doi_n)
results_df
```


## Distribution of DOIs associated with each user.

```{r stripchart}
stripchart(results_df$doi_n, method="jitter", pch=19, xlab="number of DOIs")
```


## Interactive table of outputs

```{r}
df <-results_df
id1= unlist(df$orcid)
url=sprintf('<a href="http://orcid.org/%s">%s</a>', id1, id1)
df$orcid = url
datatable(df,escape=1, options=list(pageLength=25))
```

## Example listings

Here we automatically generate a "Recent papers" section, by finding
the three most recent papers from each author with an ORCID.

```{r, results="asis",warning=FALSE}
dois = c()
for (i in 1:length(grab.info)) {
  ndois = length(grab.info[[i]]$dois)
  if (ndois>0) {
    dois = c(dois, grab.info[[i]]$dois[1:(min(3, ndois))])
  }
}           
##dois = grab.info[[4]]$dois[1:3]
b = GetBibEntryWithDOI(dois)
print(b)
##dois
```

# Compiling this document


We make heavy use of knitr; see
e.g. <https://yihui.org/knitr/options/> for chunk options.

```{r compiling, include = TRUE, eval = FALSE}
rmarkdown::render("orcid3.Rmd")
```
